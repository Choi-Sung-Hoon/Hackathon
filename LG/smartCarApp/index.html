<!DOCTYPE html>
<html>

<head>
    <title>Geolocation</title>
    <link rel="stylesheet" href="./indexCSS.css" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */

    #slist {height:200px; width:50%;
        overflow:hidden; overflow-y:scroll;}

    #response {height:200px; width:50%;
        overflow:hidden; overflow-y:scroll;}

    </style>

    <!-- Goggle map API -->
    <script>
    var map, infoWindow, i;
    var marker, marker2;
    var locations = [
        ['Forum Mall', 12.934674, 77.611170],
        ['Taco Bell', 12.937879, 77.626957]
    ];

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: -34.397, lng: 150.644 },
            zoom: 6
        });
        infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                // marker setting
                var mapOptions = {
                    center : pos,
                    zoom : 14,
                    mapTypeId : google.maps.MapTypeId.ROADMAP
                };

                map = new google.maps.Map(document.getElementById("map"),
                    mapOptions);

                marker = new google.maps.Marker({
                    position : pos,
                    map : map,
                    icon: {
                        url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                    }
                });
                //google.maps.event.addListener(marker, 'click', toggleBounce(marker));

                // add more marker
                for (i = 0; i < locations.length; i++) {
                    var posMarker = {
                        lat: locations[i][1],
                        lng: locations[i][2]
                    }

                    marker2 = new google.maps.Marker({
                        position: posMarker,
                        map: map
                    });


                }

                infoWindow.setPosition(pos);
                infoWindow.setContent('Location found.');
                infoWindow.open(map);
                map.setCenter(pos);

            }, function() {
                handleLocationError(true, infoWindow, map.getCenter());
            });
        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
        }
    }

    /*
    function calcRoute() {
        var start = document.getElementById('start').value;
        var end = document.getElementById('end').value;
        var mode = document.getElementById('mode').value;

        var request = {
            origin:start,
            destination:end,
            travelMode: eval("google.maps.DirectionsTravelMode."+mode)
        };

        console.log(start.coords.latitude);
        console.log(start.coords.longitude);
        console.log(end.coords.latitude);
        console.log(end, coords.longitude);

        directionsService.route(request, function(response, status) {
            alert(status);  // 확인용 Alert..미사용시 삭제
            if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
            }
        });
    }

    */

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
            'Error: The Geolocation service failed.' :
            'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
    }
    </script>

    <!-- webOS luna service moduling -->
    <script src="webOSjs-0.1.0/webOS.js" charset="utf-8"></script>
    <script type="text/javascript" src="lunaService.js">

    //decode encoded data
    function b64DecodeUnicode(str) {
    // Going backwards: from bytestream, to percent-encoding, to original string.
    return decodeURIComponent(atob(str).split('').map(function(c) {
    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
    }
        
    </script>
</head>

<body>

    <div id="outline">
        <div id="title">
            <h2>Let's cue, navi</h2>
            <div class="wrap-inputDestination validate-input" data-validate="Destination is required">
                <input class="inputDestination" type="text" name="name" placeholder="Enter your Destination">
                <span class="focus-inputDestination"></span>
            </div>
            <div class="container-search-btn">
                <div class="wrap-search-btn">
                    <div class="-search-bg-btn"></div>
                    <button class="search-btn">
							<span>
								Search
								<i class="fa fa-long-arrow-right m-l-7" aria-hidden="true"></i>
							</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Google Maps API, Do not remove-->
        <div id="map"></div>
    </div>


    <!-- 루나 서비스 테스트를 위해 임시로 쓰고 있는 영역 나중에는 다 지워 질 것임-->

    <!--
    <br>
    <h1>Let's cue, navi</h1>
    <button id="toast">when server send alarm</button>
    <script>
        var message = "caution! Ambulance is coming!"
        document.getElementById("toast").addEventListener("click", function() {
    createToast(message);
}, false);
    </script>
    <button onclick="adapter_startDiscovery()">start bluetooth</button>
    <button onclick="adapter_cancelDiscovery()">cancle Discovery</button>

    <button onclick="adapter_pair()">pairring</button>
    <button onclick="adapter_supplyPinCode() ">pinCode</button>
    -->

    <!--<button onclick="spp_createChannel()">ssp create channel</button>-->
    <!--
    <button onclick="spp_connect()">connect device to ssp channel</button>
    <button onclick="spp_readData()">readData</button>
    <div id="data"></div>
    <br>
    -->

    <div style="float:left">
    <nav>
        <ol id="response">
    </ol>
    </nav>
    </div>
    <div style="float:left">
    <nav>
        <ol id="slist">
        </ol>
    </nav>
    </div>
    <!--google open API key :: don't remove -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZ5nxLnM3tuIYE5s27r-kz3cK164HMjjI&callback=initMap">
    </script>
</body>

</html>