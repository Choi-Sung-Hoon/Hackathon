<!DOCTYPE html>
<html>

<head>
    <title>Let's cue, nevi</title>
    <link rel="stylesheet" href="./indexCSS.css" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZ5nxLnM3tuIYE5s27r-kz3cK164HMjjI&libraries=places"></script>
    <!-- webOS luna service moduling -->
    <script src="webOSjs-0.1.0/webOS.js" charset="utf-8"></script>
    <script type="text/javascript" src="lunaService.js"></script>
</head>
<script>
// list JS
var myNodelist = document.getElementsByTagName("li");
var i;

// Add input text in searchBar to list
function newElement() {
    var li = document.createElement("li");
    var inputValue = document.getElementById("myInput").value;
    var t = document.createTextNode(inputValue);
    li.appendChild(t);
    // if user put nothing then alert
    if (inputValue === '') {
        alert("Nothing to Search!");
    } else { // add text to list on html
        document.getElementById("myUL").appendChild(li);
        $("#myUL").append("<hr>");
    }
    document.getElementById("myInput").value = ""; // empty searchBar
}
</script>
<script type="text/javascript">

window.onload = function() {
    initialize();
};

var marker;
var map;
var geocoder;
var infowindow = null;

//form mall 위치
var latitude = 12.934674;
var longitude = 77.611170;

 
function initialize() {
    geocoder = new google.maps.Geocoder();
    var lat = latitude;
    var lng = longitude;
    var marker = marker;
    setCurrentPosition(lat, lng);
    setMarker(lat, lng);
}

function moveMarker(lat, lng) { 
    //파싱한 데이터, lat과 lng이 string일 경우를 고려
    //data string으로 받아 온 거 -> float 로 change
    latv = parseFloat(lat);
    lonv = parseFloat(lng);
    marker.setPosition(new google.maps.LatLng(latv, lonv));
}

function printMarker(lat, lng) { 
    //파싱한 데이터, lat과 lng이 string일 경우를 고려
    //data string으로 받아 온 거 -> float 로 change
    latv = parseFloat(lat);
    lonv = parseFloat(lng);
    //setCurrentPosition(latv, lonv);
    setMarker(latv, lonv);
}

function setCurrentPosition(lat, lng) {
    // 현재 GPS 변수에 넣기.
    var latitude = lat;
    var longitude = lng;

    var mapOptions = {
        zoom: 12,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        center: new google.maps.LatLng(latitude, longitude)
    };

    map = new google.maps.Map(document.getElementById('map'), mapOptions);
}

function setMarker(lat, lng) {
    // 현재 위치 마커 생성
    marker = new google.maps.Marker({
        position: new google.maps.LatLng(lat, lng),
        map: map,
        //draggable: false,
        //icon: "http://maps.google.com/mapfiles/ms/micons/man.png";
    });
    marker.addListener('click', toggleBounce); //click evnet가 아니라 웹소켓에서 뭐가 날라오는 이벤트가 발생하면 저렇게 깜박이는 게 낫겠다.
}

function drawCircle(lat, lng) {
    // 현재 위치 기준 원 그리기 -- 엠뷸런스에 쓰면 좋겠다
    var populationOptions = {
        strokeColor: '#000000',
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: '#808080',
        fillOpacity: 0.5,
        map: map,
        center: new google.maps.LatLng(lat, lng),
        radius: 10000
    };
    cityCircle = new google.maps.Circle(populationOptions);
}


function toggleBounce() {
    if (marker.getAnimation() !== null) {
        marker.setAnimation(null);
    } else {
        marker.setAnimation(google.maps.Animation.BOUNCE);
    }
}
</script>
</head>

<body>
    <div id="outline">
        <div id="title">
            <h2>Let's cue, navi</h2>
            <div class="wrap-inputDestination validate-input" data-validate="Destination is required">
                <input id="myInput" class="inputDestination" type="text" name="name" placeholder="Enter your Destination">
                <span class="focus-inputDestination"></span>
            </div>
            <div class="container-search-btn">
                <div class="wrap-search-btn">
                    <div class="search-bg-btn"></div>
                    <button class="search-btn" onclick="newElement()">
                        <span>
                            Search
                            <i class="fa fa-long-arrow-right m-l-7" aria-hidden="true"></i>
                        </span>
                    </button>
                </div>
            </div>
        </div>
        <div id="contents">
            <div id="map"></div>
            <div id="wrap-list">
                <div id="myUL"></div>
            </div>
        </div>
        <button onclick="printMarker(12.937979,77.623957)">changeMarker</button>
    </div>
</body>

</html>